syntax = "proto3";

package modeldist;

enum ModelFormat {
  STATE_DICT = 0;   // torch.save(state_dict)
  TORCHSCRIPT = 1;  // torch.jit.save()
  ONNX = 2;         // onnx bytes
}

message ModelRequest {
  string model_name = 1;      // "resnet18-ibn-v1"
  ModelFormat format = 2;     // STATE_DICT / TORCHSCRIPT / ONNX
  string version = 3;         // "1.0.3"
}

message ModelChunk {
  bytes data = 1;             // peda√ßo do arquivo
}

message ModelHeader {
  string model_name = 1;
  ModelFormat format = 2;
  string version = 3;
  string arch = 4;            // "resnet18"
  string dtype = 5;           // "float16", "bfloat16", "float32"
  uint64 total_size = 6;      // em bytes
  string sha256 = 7;          // checksum
}

message ModelStream {
  oneof part {
    ModelHeader header = 1;
    ModelChunk chunk = 2;
  }
}

service ModelDistributor {
  rpc GetModel (ModelRequest) returns (stream ModelStream);
}
